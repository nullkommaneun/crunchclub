<!doctype html>
<html lang="de">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CrunchClub ¬∑ Weiterleitung‚Ä¶</title>
<style>
  body{margin:0;display:grid;place-items:center;height:100svh;font:16px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;background:#0b0f1a;color:#e5e7eb}
  .card{padding:22px 22px;border-radius:16px;border:1px solid #1f2937;background:#101726;max-width:520px;width:min(92vw,520px);text-align:center;position:relative;overflow:hidden}
  .badge{width:100px;height:100px;margin:0 auto 14px;border-radius:50%;
         background:radial-gradient(circle at 35% 30%, #dc2626, #7f1d1d);
         display:grid;place-items:center;font-size:42px;color:#fff;font-weight:900;letter-spacing:-1px;
         box-shadow:0 0 18px rgba(220,38,38,.4), inset 0 0 12px rgba(0,0,0,.5);}
  .m{font-size:14px;color:#9ca3af}
</style>
<body>
  <div class="card">
    <div class="badge">üçú</div>
    <b>CrunchClub</b>
    <div class="m">Sichere Weiterleitung ‚Ä¶</div>
    <div id="msg" class="m" style="margin-top:8px"></div>
  </div>

<script>
/** ========== KONFIG ========== */
const APP_URL = "https://script.google.com/macros/s/AKfycbzdDii900AOXGpJcp1kMnbV6Hk7VwMBMVHFKKceldOtGbamGqXRgzhR341mEDeCgrQ/exec"; // deine aktuelle WebApp-URL
const DEFAULT_VENUE = "crunchclub-zwickau";
/** ============================ */

(function(){
  const Q = new URLSearchParams(location.search);
  const VENUE = Q.get('venue_id') || DEFAULT_VENUE;
  const TOKEN = Q.get('token') || '';

  function getCID(){
    try{
      let id = localStorage.getItem('cc_client_id');
      if(!id){ id = crypto.randomUUID(); localStorage.setItem('cc_client_id', id); }
      return id;
    }catch(e){ return ''; }
  }

  // Eindeutige scan_id (Idempotenz f√ºr Server)
  const scanId = (crypto && crypto.randomUUID) ? crypto.randomUUID()
                  : (Date.now()+'_'+Math.random().toString(36).slice(2));

  const cid = encodeURIComponent(getCID());
  const ua  = encodeURIComponent(navigator.userAgent || '');

  if(!TOKEN){
    document.getElementById('msg').textContent = 'Fehlender Code ‚Äì bitte QR erneut scannen.';
    return;
  }

  const url = `${APP_URL}?venue_id=${encodeURIComponent(VENUE)}&token=${encodeURIComponent(TOKEN)}&client_id=${cid}&ua=${ua}&scan_id=${encodeURIComponent(scanId)}`;

  document.getElementById('msg').textContent = 'Verbinde ‚Ä¶';
  location.replace(url);
})();
</script>
</body>
</html>
