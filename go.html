<!doctype html>
<html lang="de">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CrunchClub · Weiterleitung…</title>
<style>
  :root{
    --fg:#e6eaf0; --accent:#f59e0b;
  }
  html,body{height:100%;margin:0;background:#0b0f1a;color:var(--fg);font:16px system-ui,sans-serif}
  .pre{position:fixed;inset:0;z-index:9999;display:grid;place-items:center;backdrop-filter:blur(2px);background:#0b0f1a}
  .card{background:#101726cc;border:1px solid #1f2937;border-radius:16px;padding:22px;box-shadow:0 10px 32px rgba(0,0,0,.4);min-width:280px}
  .top{display:flex;gap:14px;align-items:center}
  .title{font-weight:700}
  .muted{color:#9ca3af}
  .icon{width:64px;height:64px;display:grid;place-items:center}
  .ramen-steam path{stroke:var(--accent);stroke-width:2;fill:none;stroke-linecap:round;stroke-dasharray:40 120;animation:steam 2.2s ease-in-out infinite}
  .ramen-steam path:nth-child(2){animation-delay:.25s}
  .ramen-steam path:nth-child(3){animation-delay:.5s}
  @keyframes steam{0%{stroke-dashoffset:0;opacity:.2}50%{opacity:1}100%{stroke-dashoffset:-160;opacity:.2}}
  .ramen-bowl{fill:none;stroke:#3b4a5e;stroke-width:2}
  .pre.hide{animation:fade .6s ease forwards}
  @keyframes fade{to{opacity:0;visibility:hidden}}
</style>
<body>
  <!-- Loader -->
  <div class="pre" id="pre">
    <div class="card">
      <div class="top">
        <div class="icon">
          <svg width="64" height="64" viewBox="0 0 64 64" aria-hidden="true">
            <g class="ramen-steam">
              <path d="M18 22 C22 18, 28 18, 32 22"/>
              <path d="M26 18 C30 14, 36 14, 40 18"/>
              <path d="M34 22 C38 18, 44 18, 48 22"/>
            </g>
            <path class="ramen-bowl" d="M14 32 q18 12 36 0 v4 a22 22 0 0 1-36 0z"/>
          </svg>
        </div>
        <div>
          <div class="title">Küche heizt an…</div>
          <div class="muted">Ramen wird vorbereitet</div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  // Ziel-URL vorbereiten
  const Q = new URLSearchParams(location.search);
  const VENUE = Q.get('venue_id') || 'crunchclub-zwickau';
  const TOKEN = Q.get('token') || '';
  const APP  = 'https://script.google.com/macros/s/AKfycbzdDii900AOXGpJcp1kMnbV6Hk7VwMBMVHFKKceldOtGbamGqXRgzhR341mEDeCgrQ/exec';

  function getCID(){
    try{
      let id=localStorage.getItem('cc_client_id');
      if(!id){id=crypto.randomUUID();localStorage.setItem('cc_client_id',id);}
      return id;
    }catch(e){return '';}
  }

  const cid=encodeURIComponent(getCID());
  const ua=encodeURIComponent(navigator.userAgent||'');

  // Sobald die Seite komplett geladen ist
  window.addEventListener('load',()=>{
    // Loader ausblenden
    document.getElementById('pre').classList.add('hide');

    // und nach kurzer Fade-Zeit weiterleiten
    setTimeout(()=>{
      if(!TOKEN){
        alert('Fehlender Token – bitte QR erneut scannen.');
        return;
      }
      const url=`${APP}?venue_id=${encodeURIComponent(VENUE)}&token=${encodeURIComponent(TOKEN)}&client_id=${cid}&ua=${ua}`;
      location.replace(url);
    },600);
  });
})();
</script>
</body>
</html>
